package net.ccbluex.liquidbounce.features.module.modules.exploit

import net.ccbluex.liquidbounce.event.events.NotificationEvent
import net.ccbluex.liquidbounce.event.events.PacketEvent
import net.ccbluex.liquidbounce.event.handler
import net.ccbluex.liquidbounce.features.module.Category
import net.ccbluex.liquidbounce.features.module.Module
import net.ccbluex.liquidbounce.utils.client.notification
import net.minecraft.network.packet.s2c.play.PlayerListS2CPacket

    /**
     * Notifies you about staff actions.
     * This current implementation isn't very good, however it's better than having nothing like the old one did
     * We are comparing if the player list size is different to the tab list size. If it is then we send a notification
     * However this approach is pretty naive and assumes perfect conditions.
     * A better approach would be to check if the amount of players and then
     * pinging the server like MeteorServerSeeker does to check the online amount of players
     */

object ModuleAntiVanish : Module("AntiVanish", Category.EXPLOIT) {

    var previousPlayerListSize = 0

    val packetHandler = handler<PacketEvent> { event ->
        if (event.packet !is PlayerListS2CPacket) {
            return@handler
        }

        val packet = event.packet as PlayerListS2CPacket
        val currentPlayerListSize = mc.player?.networkHandler?.playerList?.size ?: 0

        if (currentPlayerListSize < previousPlayerListSize) {
            notification("AntiVanish", "Staff detected, online players: $currentPlayerListSize", NotificationEvent.Severity.INFO)
        } else if (currentPlayerListSize > previousPlayerListSize) {
            notification("AntiVanish", "All clear, online players: $currentPlayerListSize", NotificationEvent.Severity.INFO)
        }

        previousPlayerListSize = currentPlayerListSize
    }
}
