package net.ccbluex.liquidbounce.features.module.modules.exploit.disablermodes.verus

import net.ccbluex.liquidbounce.features.module.modules.exploit.disablermodes.DisablerMode
import net.ccbluex.liquidbounce.utils.PacketUtils.sendPacket
import net.ccbluex.liquidbounce.utils.extensions.toVec
import net.minecraft.init.Items
import net.minecraft.item.ItemStack
import net.minecraft.network.play.client.C08PacketPlayerBlockPlacement
import net.minecraft.init.Blocks

/*
* Working on Verus: b3898
* Tested on: anticheat-test.com, eu.losiya.cn
*
* Disables most Fly checks on the Verus Anticheat
* Allowing for slow Vanilla fly and fast onGround speeds
*/

object VerusFly : DisablerMode("VerusFly") {
    var dontPlaceOnAttack = true

    override fun onUpdate() {
        val player = mc.thePlayer ?: return
        if (dontPlaceOnAttack && !player.isDead) {
            val pos = player.position.add(0, if(player.posY > 0) -100 else 100 , 0) ?: return


            sendPacket(
                C08PacketPlayerBlockPlacement(
                    pos,
                    1,
                    ItemStack(Items.water_bucket),
                    0F,
                    0.5F + Math.random().toFloat() * 0.44F,
                    0F
                )
            )
        } else {
            dontPlaceOnAttack = true
        }
    }

    override fun onAttack() {
        dontPlaceOnAttack = false
    }
}
