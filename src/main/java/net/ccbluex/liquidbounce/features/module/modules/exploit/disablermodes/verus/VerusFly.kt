package net.ccbluex.liquidbounce.features.module.modules.exploit.disablermodes.verus

import net.ccbluex.liquidbounce.features.module.modules.exploit.disablermodes.DisablerMode
import net.ccbluex.liquidbounce.utils.PacketUtils.sendPacket
import net.ccbluex.liquidbounce.utils.extensions.toVec
import net.minecraft.init.Items
import net.minecraft.item.ItemStack
import net.minecraft.network.play.client.C08PacketPlayerBlockPlacement
import net.minecraft.init.Blocks

/*
* Working on Verus: b3898
* Tested on: anticheat-test.com, eu.losiya.cn
*
* Disables most Fly checks on the Verus Anticheat
* Allowing for slow Vanilla fly and fast onGround speeds
*/

object VerusFly : DisablerMode("VerusFly") {
    private var dontPlaceOnAttack = true

    override fun onUpdate() {
        if (dontPlaceOnAttack) {
            val pos = mc.thePlayer.position.add(0.0, mc.thePlayer.eyeHeight.toDouble(), 0.0)
            var blockPos = mc.theWorld.rayTraceBlocks(pos.toVec(), pos.add(pos.x.toDouble(), pos.y * 3.0, pos.z.toDouble()).toVec(), false,false,false).blockPos
            if(mc.theWorld.getBlockState(blockPos) != Blocks.air)
            {
               blockPos = blockPos.add(0.0, 1.0, 0.0)
            }
            sendPacket(
                C08PacketPlayerBlockPlacement(
                    blockPos,
                    1,
                    ItemStack(Items.water_bucket),
                    0F,
                    0.5F + Math.random().toFloat() * 0.44F,
                    0F
                )
            )

        }
        dontPlaceOnAttack = true
    }

    override fun onAttack() {
        dontPlaceOnAttack = false
    }
}
